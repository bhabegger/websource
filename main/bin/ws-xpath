#!/usr/bin/perl

=head1 NAME

ws-xpath : Search for an XPATH expression in an XML or HTML document

=head2 DESCRIPTION

This allows to search for an XPATH expression in a document which has been
parsed using the WebSource::Parser module. Hopefully it allows to search
for XPATH expression in even badly formatted HTML documents.

=cut

use WebSource::Parser;
use Getopt::Mixed;

Getopt::Mixed::getOptions(
  "e=s expr>e",
);

$opt_e or die "No xpath expression given\n";

my $parser = WebSource::Parser->new;

foreach my $file (@ARGV) {
  my $doc = $parser->parse_html_file($file);
  my $result = $doc->find($opt_e);
  if(UNIVERSAL::isa($result,"XML::LibXML::NodeList")) {
    foreach my $node ($result->get_nodelist()) {
      print "--\n",$node->toString(1),"\n";
    }
  } else {
    print $result->to_literal,"\n";
  }
}
